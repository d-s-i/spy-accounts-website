import React from "react";
import type { NextPage } from "next";
import Head from "next/head";

import { AccountTable } from "../components/Tables/AccountTable/AccountTable";
import { DateTitle } from "../components/UI/DateTitle";
import { Container } from "@mui/material";
import { MyAppBar } from "../components/UI/MyAppBar";
import { getYesterdayFromDate } from "../utils";

import { BASE_URL } from "../api/constants";

import { StarknetDay } from "../types";

const Home: NextPage = () => {

  const [date, setDate] = React.useState<string>();
  const [starknetDay, setStarknetDay] = React.useState<StarknetDay>();

  
  React.useEffect(() => {

    const _date = new Date(Date.now());
    const formatedDate = getYesterdayFromDate(_date);
    setDate(formatedDate);

    const URL = `${BASE_URL}/${_date}`;

    const getAndSetStarknetDay = async function(url: string) {
      const _res = await fetch(URL);
      const res = await _res.json();

      setStarknetDay(res.data.starknetDay);
    }

    getAndSetStarknetDay(URL);    
  }, []);
  
  return (
    <React.Fragment>
      <Head>
        <title>Spy Accounts</title>
        <meta name="description" content="Generated by create next app" />
      </Head>
      <MyAppBar />
      <Container>
        <DateTitle date={date} />
        <AccountTable organizedAccountsActivity={starknetDay?.organizedAccountsActivity || {}} />
      </Container>
    </React.Fragment>
  );
}

export default Home;
